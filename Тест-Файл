Ниже представлен тест-файл. text и text2 состоят из 164 слов. Оба отличнаются 5 словами. При константной длине шингла=2 результатом работы должен быть процент порядка 95-100%.
После работы программы, результатом является следующее число: 95.522388059701 %



<?php


$text = " А впрочем, я слишком много болтаю. Оттого и ничего не делаю, что болтаю. Пожалуй, впрочем, и так: оттого болтаю, что ничего не делаю. Это я в этот последний месяц выучился болтать, лежа по целым суткам в углу и думая... о царе Горохе. Ну зачем я теперь иду? Разве я способен на это? Разве это серьезно? Совсем не серьезно. Так, ради фантазии сам себя тешу; игрушки! Да, пожалуй что и игрушки!»На улице жара стояла страшная, к тому же духота, толкотня, всюду известка, леса, кирпич, пыль и та особенная летняя вонь, столь известная каждому петербуржцу, не имеющему возможности нанять дачу, — всё это разом неприятно потрясло и без того уже расстроенные нервы юноши. Нестерпимая же вонь из распивочных, которых в этой части города особенное множество, и пьяные, поминутно попадавшиеся, несмотря на буднее время, довершили отвратительный и грустный колорит картины. Чувство глубочайшего омерзения мелькнуло на миг в тонких чертах молодого человека. Кстати, он был замечательно хорош собою, с прекрасными темными глазами, темно-рус, ростом выше среднего, тонок и строен. " ;
$text2 = "Отличаются тут первые пять слов. Оттого и ничего не делаю, что болтаю. Пожалуй, впрочем, и так: оттого болтаю, что ничего не делаю. Это я в этот последний месяц выучился болтать, лежа по целым суткам в углу и думая... о царе Горохе. Ну зачем я теперь иду? Разве я способен на это? Разве это серьезно? Совсем не серьезно. Так, ради фантазии сам себя тешу; игрушки! Да, пожалуй что и игрушки!»На улице жара стояла страшная, к тому же духота, толкотня, всюду известка, леса, кирпич, пыль и та особенная летняя вонь, столь известная каждому петербуржцу, не имеющему возможности нанять дачу, — всё это разом неприятно потрясло и без того уже расстроенные нервы юноши. Нестерпимая же вонь из распивочных, которых в этой части города особенное множество, и пьяные, поминутно попадавшиеся, несмотря на буднее время, довершили отвратительный и грустный колорит картины. Чувство глубочайшего омерзения мелькнуло на миг в тонких чертах молодого человека. Кстати, он был замечательно хорош собою, с прекрасными темными глазами, темно-рус, ростом выше среднего, тонок и строен. " ;
echo Shingles::analyze($text2, $text) ;

class Shingles { 

const SHINGLES_LEN = 2 ;   

public static function analyze ($source1, $source2)    
{      
$words1 = self::canonize($source1) ;    
$shingles1 = self::shinglesGen($words1) ; 

$words2 = self::canonize($source2) ;  
$shingles2 = self::shinglesGen($words2) ;  

$intersection = array_intersect($shingles1, $shingles2) ;   

$intersectionPercent = (count($intersection) / count($words1)) * 100 ; 

return $intersectionPercent ;    
}  

private static function canonize($text)  
{     
$words = explode(' ', $text) ;  

$result = array() ;     
foreach($words as $k=>$w)  
{       
$w = strtolower($w) ;       
$w = preg_replace(self::$filter, '', $w) ;

if(!empty($w)) 
{            
$result[] = trim($w); ;        
  }      
}     

return $result ;   
}         


private static function shinglesGen($words) 
{         
$wordsLen = count($words) ; 
$shinglesCount = $wordsLen - (self::SHINGLES_LEN - 1) ; 

$shingles = array() ; 


for($i=0; $i < $shinglesCount; $i++)   
{             
  $sh = array() ;  
  for($k=$i; $k < $i + self::SHINGLES_LEN; $k++)  
  {                           
     $sh[] = $words[$k] ;       
  }                        
     $shingles[] = crc32( implode(' ', $sh) ) ;  
  }                  
return $shingles ;    
}      


private static $filter = array(
'/,/',  
'/\./',    
'/\!/',     
'/\?/',      
'/\(/',      
'/\)/',    
'/-/',      
'/—/',     
'/:/',     
'/;/',     
'/"/',       
'/^это$/',   
'/^как$/',   
'/^так$/',   
'/^в$/',     
'/^на$/',    
'/^над$/',   
'/^к$/',     
'/^ко$/',    
'/^до$/',    
'/^за$/',    
'/^то$/',    
'/^с$/',     
'/^со$/',    
'/^для$/',   
'/^о$/',     
'/^ну$/',    
'/^же$/',    
'/^ж$/',     
'/^что$/',   
'/^он$/',    
'/^она$/',   
'/^б$/',     
'/^бы$/',    
'/^ли$/',    
'/^и$/',     
'/^у$/'   
) ; 

}

?>
